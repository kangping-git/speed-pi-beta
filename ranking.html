<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ranking</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/5.0.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.0.1/firebase-database.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <link rel="shortcut icon" href="./favicon.ico">
    <style>
        li{
            cursor: pointer;
        }
        body{
            -webkit-user-select: none;
               -moz-user-select: none;
                -ms-user-select: none;
                    user-select: none;
        }
    </style>
</head>
<body>
    <a href="#" data-target="slide-out" class="sidenav-trigger" style="font-size: 20pt;"><i class="material-icons">menu</i></a>
    <main style="text-align: center;">
        <h2>speed pi beta ranking</h2>
        <ul id="slide-out" class="sidenav">
            <div class="collection" style="width: 75%;margin-left: auto;margin-right: auto;">
                <a class="collection-item" id="item_1" onclick="change_item('rank_pi_list','item_1')" style="cursor: pointer;">pi</a>
                <a class="collection-item" id="item_2" onclick="change_item('rank_root_list','item_2')" style="cursor: pointer;"><span style="font-family: Consolas, 'Courier New', monospace;">âˆš</span>2</a>
                <a class="collection-item" id="item_3" onclick="change_item('rank_golden_list','item_3')" style="cursor: pointer;">Golden ratio</a>
                <a class="collection-item" id="item_4" onclick="change_item('rank_napier_list','item_4')" style="cursor: pointer;">napier</a>
            </div>
        </ul>
        <div class="input-field col s12" style="width: 75%;margin-left: auto;margin-right: auto;">
            <select id="opt" onchange="change_html()">
                <option value="all" checked>all</option>
                <option value="7">During recent seven days</option>
                <option value="31">During recent thirty one days</option>
            </select>
            <label>Conditions to display</label>
        </div>
        <label></label>
        <table style="width: 75%;margin-left: auto;margin-right: auto;">
            <thead>
                <tr><td>Name</td><td>Score</td><td>clear</td><td>TPS [type/second]</td><td>Date</td></tr>
            </thead>
            <tbody id="body"></tbody>
        </table>
        <ul class="pagination">
            <li id="left" onclick="change_hash(0)"><a><i class="material-icons">chevron_left</i></a></li>
            <a id="pagination_main"></a>
            <li id="right" onclick="change_hash(1)"><a><i class="material-icons">chevron_right</i></a></li>
        </ul>
        <a class="button" href="./speed-Pi.html" target="_blank" rel="noopenar">speed pi</a><br>
        powerd by <a class="button" href="https://kangping.jp" target="_blank" rel="noopenar">kangping</a>
    </main>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var elems = document.querySelectorAll('select');
            var instances = M.FormSelect.init(elems, {});
        });
        document.addEventListener('DOMContentLoaded', function() {
            var elems = document.querySelectorAll('.sidenav');
            var instances = M.Sidenav.init(elems, {});
        });
        function change_hash(mode){
            if (mode == 0){
                if (Number(location.hash.replace("#","")) != 1){
                    location.hash = Number(location.hash.replace("#",""))-1
                }
            }
            if (mode == 1){
                if (Number(location.hash.replace("#","")) != Math.ceil(data.length / 10)){
                    location.hash = Number(location.hash.replace("#",""))+1
                }
            }
        }
        const config = {
            apiKey: "AIzaSyDZsD6Lspm6PJ9VvCd3ReJe5T6ex36nRc8",
            authDomain: "speed-pi-database.firebaseapp.com",
            databaseURL: "https://speed-pi-database-default-rtdb.firebaseio.com",
            projectId: "speed-pi-database",
            storageBucket: "speed-pi-database.appspot.com",
            messagingSenderId: "744730019739",
            appId: "1:744730019739:web:88c0a38a65c3badbff033e",
            measurementId: "G-H0PVNZSRXX"
        };
        firebase.initializeApp(config);
        var rank_pi = firebase.database().ref().child("rank").child("endress").child("pi")
        var rank_root = firebase.database().ref().child("rank").child("endress").child("root")
        var rank_golden = firebase.database().ref().child("rank").child("endress").child("golden")
        var rank_napier = firebase.database().ref().child("rank").child("endress").child("napier")
        var rank_pi_list = []
        var rank_root_list = []
        var rank_golden_list = []
        var rank_napier_list = []
        var data = []
        var data2 = []
        var data3 = ""
        change_item("rank_pi_list",'item_1')
        if (!location.hash){
            location.hash = 1
        }
        rank_pi.on("child_added",(val) => {
            rank_pi_list.push(val.val())
            change_html()
        })
        rank_root.on("child_added",(val) => {
            rank_root_list.push(val.val())
            change_html()
        })
        rank_golden.on("child_added",(val) => {
            rank_golden_list.push(val.val())
            change_html()
        })
        rank_napier.on("child_added",(val) => {
            rank_napier_list.push(val.val())
            change_html()
        })
        function change_item(item_list,id_name){
            data3 = item_list
            var daaaataaaaa = ["item_1","item_2","item_3","item_4"]
            for (var i in daaaataaaaa){
                if (daaaataaaaa[i] == id_name){
                    document.getElementById(daaaataaaaa[i]).className = "collection-item active"
                }else{
                    document.getElementById(daaaataaaaa[i]).className = "collection-item"
                }
            }
            change_html()
        }
        function change_html(){
            data2 = window[data3]
            data2 = data2.sort((a,b) => {
                if (b.score - a.score != 0){
                    return b.score - a.score
                }else{
                    return a.timer - b.timer
                }
            })
            if (document.getElementById("opt").value == "all"){
                data = data2
            }else if (document.getElementById("opt").value == "7"){
                data = data2.filter((obj) => {
                    return new Date() - new Date(obj.time) < 60*60*1000*24*7
                })
            }else if (document.getElementById("opt").value == "31"){
                data = data2.filter((obj) => {
                    return new Date() - new Date(obj.time) < 60*60*1000*24*31
                })
            }
            var html = ""
            for (var i in data){
                if ((Number(location.hash.replace("#",""))-1) * 10 <= i && i < (Number(location.hash.replace("#",""))) * 10){
                    html += `<tr><td>${data[i].name}</td><td>${data[i].score}</td><td>${data[i].timer / 1000}s</td><td>${(data[i].score/(data[i].timer/1000)).toFixed(2)}</td><td>${new Date(data[i].time).getFullYear() + "/" + ("0" + (new Date(data[i].time).getMonth() + 1)).slice(-2) + "/" + ("0" + (new Date(data[i].time).getDate())).slice(-2) + " " + ("0" + (new Date(data[i].time).getHours())).slice(-2) + ":" + ("0" + (new Date(data[i].time).getMinutes())).slice(-2) + ":" + ("0" + (new Date(data[i].time).getSeconds())).slice(-2)}</td></tr>`
                }
            }
            document.getElementById("body").innerHTML = html
            if (Number(location.hash.replace("#","")) == 1){
                document.getElementById("left").className = "disabled"
            }else{
                document.getElementById("left").className = ""
            }
            if (Number(location.hash.replace("#","")) == Math.ceil(data.length / 10)){
                document.getElementById("right").className = "disabled"
            }else{
                document.getElementById("right").className = ""
            }
            var html = ""
            for (var i = 1;i <= Math.ceil((data.length) / 10);++i){
                if (i == (Number(location.hash.replace("#","")))){
                    html += '<li class="active"><a>' + i +'</a></li>'
                }else{
                    html += '<li class="waves-effect"><a href="#' + i + '">' + i +'</a></li>'
                }
            }
            document.getElementById("pagination_main").innerHTML = html
        }
        window.addEventListener("hashchange",() => {
            change_html()
        })
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
</body>
</html>